apiVersion: constraints.gatekeeper.sh/v1beta1
kind: SecretTrustedUsage
metadata:
  name: kyma-bot-triage-token
spec:
  enforcementAction: warn
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
  parameters:
    restrictedSecrets:
      - kyma-bot-triage-token
    trustedImages:
      # Prowjob name: ci-kyma-bot-triage-close
      - image: "gcr.io/k8s-prow/commenter:*"
        command:
          - /tools/entrypoint
        args: []
        entrypoint_options: '^{.*"args":\["commenter","--query=org:kyma-project\norg:kyma-incubator\n-label:lifecycle/frozen\n-label:lifecycle/active\nlabel:lifecycle/stale","--updated=168h","--token=/etc/github-token/token","--endpoint=http://ghproxy.default.svc.cluster.local","--endpoint=https://api.github.com","--comment=This issue or PR has been automatically closed due to the lack of activity.\nThank you for your contributions.\n\nThis bot triages issues and PRs according to the following rules:\n- After 60d of inactivity, `lifecycle/stale` is applied\n- After 7d of inactivity since `lifecycle/stale` was applied, the issue is closed\n\nYou can:\n- Reopen this issue or PR with `/reopen`\n- Mark this issue or PR as fresh with `/remove-lifecycle stale`\n\nIf you think that I work incorrectly, kindly [raise an issue](https://github.com/kyma-project/test-infra/issues/new/choose) with the problem.\n\n/close","--template","--ceiling=10","--confirm"\],"container_name":"test",.*}$'
      # Prowjob name: ci-kyma-bot-triage-stale
      - image: "gcr.io/k8s-prow/commenter:*"
        command:
          - /tools/entrypoint
        args: []
        entrypoint_options: '^{.*"args":\["commenter","--query=org:kyma-project\norg:kyma-incubator\n-label:lifecycle/frozen\n-label:lifecycle/active\n-label:lifecycle/stale\n-label:lifecycle/rotten","--updated=1440h","--token=/etc/github-token/token","--endpoint=http://ghproxy.default.svc.cluster.local","--endpoint=https://api.github.com","--comment=This issue or PR has been automatically marked as stale due to the lack of recent activity.\nThank you for your contributions.\n\nThis bot triages issues and PRs according to the following rules:\n- After 60d of inactivity, `lifecycle/stale` is applied\n- After 7d of inactivity since `lifecycle/stale` was applied, the issue is closed\n\nYou can:\n- Mark this issue or PR as fresh with `/remove-lifecycle stale`\n- Close this issue or PR with `/close`\n\nIf you think that I work incorrectly, kindly [raise an issue](https://github.com/kyma-project/test-infra/issues/new/choose) with the problem.\n\n/lifecycle stale","--template","--ceiling=10","--confirm"\],"container_name":"test",.*}$'
