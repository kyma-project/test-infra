# Code generated by rendertemplates. DO NOT EDIT.


presubmits: # runs on PRs
  kyma-project/kyma:
    - name: pre-main-kyma-integration-k3d
      annotations:
        description: "Kyma integration job on k3d"
        owner: "goat"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "pre-main-kyma-integration-k3d"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-pr: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-central-app-connectivity-enabled: "true"
        preset-sa-vm-kyma-integration: "true"
      run_if_changed: '^((tests/fast-integration\S+|resources\S+|installation\S+|tools/kyma-installer\S+)(\.[^.][^.][^.]+$|\.[^.][^dD]$|\.[^mM][^.]$|\.[^.]$|/[^.]+$))'
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-incubator
          repo: local-kyma
          base_ref: main
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: pre-main-kyma-integration-k3d-central-app-connectivity-compass
      annotations:
        description: "It tests Compass integration. It won't be needed after the implementation of this issue - https://github.com/kyma-project/kyma/issues/15037"
        owner: "framefrog"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "pre-main-kyma-integration-k3d-central-app-connectivity-compass"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-pr: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-central-app-connectivity-enabled: "true"
        preset-kyma-integration-compass-dev: "true"
        preset-kyma-integration-compass-enabled: "true"
        preset-sa-vm-kyma-integration: "true"
      optional: true
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-incubator
          repo: local-kyma
          base_ref: main
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: pre-main-serverless-integration-k3s
      annotations:
        description: "serverless integration k3s job"
        owner: "otters"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "pre-main-serverless-integration-k3s"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-pr: "true"
        preset-dind-enabled: "true"
        preset-kind-volume-mounts: "true"
        preset-kyma-guard-bot-github-token: "true"
      run_if_changed: '^((resources/serverless|tests/function-controller)\S+(\.[^.][^.][^.]+|\.[^.][^dD]|\.[^mM][^.]|\.[^.]$|/[^.]+))$'
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/testimages/e2e-dind-k3d:v20230726-6389623f"
            securityContext:
              privileged: true
              seccompProfile:
                type: Unconfined
              allowPrivilegeEscalation: true
            command:
              - "/init.sh"
            args:
              - "bash"
              - "-c"
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/cluster-integration/kyma-serverless-integration-k3d.sh serverless-integration simple-tracing
"
            env:
              - name: KYMA_SOURCES_DIR
                value: "/home/prow/go/src/github.com/kyma-project/kyma"
            resources:
              requests:
                memory: 4Gi
                cpu: 3
    - name: pre-main-serverless-git-auth-integration-k3s
      annotations:
        description: "Serverless git-function authentication nightly integration tests"
        owner: "otters"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "pre-main-serverless-git-auth-integration-k3s"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-pr: "true"
        preset-dind-enabled: "true"
        preset-kind-volume-mounts: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-serverless-git-auth: "true"
      run_if_changed: '^((resources/serverless|tests/function-controller)\S+(\.[^.][^.][^.]+|\.[^.][^dD]|\.[^mM][^.]|\.[^.]$|/[^.]+))$'
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/testimages/e2e-dind-k3d:v20230726-6389623f"
            securityContext:
              privileged: true
              seccompProfile:
                type: Unconfined
              allowPrivilegeEscalation: true
            command:
              - "/init.sh"
            args:
              - "bash"
              - "-c"
              - "export APP_TEST_GITHUB_SSH_AUTH_KEY=\"${GH_AUTH_PRIVATE_KEY}\" &&
export APP_TEST_AZURE_BASIC_AUTH_USERNAME=\"${AZURE_DEVOPS_AUTH_USERNAME}\" &&
export APP_TEST_AZURE_BASIC_AUTH_PASSWORD=\"${AZURE_DEVOPS_AUTH_PASSWORD}\" &&
/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/cluster-integration/kyma-serverless-integration-k3d.sh git-auth-integration
"
            env:
              - name: KYMA_SOURCES_DIR
                value: "/home/prow/go/src/github.com/kyma-project/kyma"
            resources:
              requests:
                memory: 4Gi
                cpu: 3
    - name: pre-main-kyma-integration-k3d-telemetry
      annotations:
        description: "runs telemetry integration tests on k3d"
        owner: "huskies"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "pre-main-kyma-integration-k3d-telemetry"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-pr: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-telemetry-enabled: "true"
        preset-sa-vm-kyma-integration: "true"
      run_if_changed: '^resources/telemetry/|^installation/resources/crds/telemetry/|^tests/fast-integration/telemetry-test/'
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            resources:
              requests:
                memory: 3Gi
                cpu: 2
    - name: pre-main-kyma-eval-istio-integration-k3d
      annotations:
        description: "runs istio integration tests with evaluation profile on k3d"
        owner: "goat"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "pre-main-kyma-eval-istio-integration-k3d"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-pr: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-istio-evaluation: "true"
        preset-sa-vm-kyma-integration: "true"
      run_if_changed: '(^resources/istio/.*)|(^resources/istio-resources/.*)|(^tests/components/istio/.*)'
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            resources:
              requests:
                memory: 3Gi
                cpu: 2
    - name: pre-main-kyma-prod-istio-integration-k3d
      annotations:
        description: "runs istio integration tests with production profile on k3d"
        owner: "goat"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "pre-main-kyma-prod-istio-integration-k3d"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-pr: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-istio-production: "true"
        preset-sa-vm-kyma-integration: "true"
      run_if_changed: '(^resources/istio/.*)|(^resources/istio-resources/.*)|(^tests/components/istio/.*)'
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            resources:
              requests:
                memory: 3Gi
                cpu: 2
    - name: pre-main-kyma-istio-reconcilation-k3d
      annotations:
        description: "runs istio reconcilation tests with production profile on k3d"
        owner: "goat"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "pre-main-kyma-istio-reconcilation-k3d"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-pr: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-istio-production: "true"
        preset-sa-vm-kyma-integration: "true"
      run_if_changed: '(^resources/istio/.*)|(^resources/istio-resources/.*)|(^tests/components/istio/.*)'
      optional: true
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            env:
              - name: RECONCILATION_TEST
                value: "true"
            resources:
              requests:
                memory: 3Gi
                cpu: 2
  
postsubmits: # runs on main
  kyma-project/kyma:
    - name: post-main-kyma-integration-k3d
      annotations:
        description: "Kyma integration job on k3d."
        owner: "huskies,goat"
        testgrid-dashboards: "kyma_integration"
        testgrid-days-of-results: "60"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "post-main-kyma-integration-k3d"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-main: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-central-app-connectivity-enabled: "true"
        preset-sa-vm-kyma-integration: "true"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      max_concurrency: 10
      branches:
        - ^master$
        - ^main$
      extra_refs:
        - org: kyma-incubator
          repo: local-kyma
          base_ref: main
        - org: kyma-project
          repo: test-infra
          base_ref: main
      reporter_config:
        slack:
          channel: huskies-notifications
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
  
periodics: # runs on schedule
    - name: utilities-kyma-integration-cleaner
      annotations:
        description: "kyma integration cleaner"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "utilities-kyma-integration-cleaner"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-project-env: "true"
        preset-sa-vm-kyma-integration: "true"
      cron: "30 * * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        serviceAccountName: sa-prow-job-resource-cleaners
        containers:
          - image: "eu.gcr.io/kyma-project/prow/cleaner:0.0.1"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "./cleaner.sh"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: orphaned-assetstore-gcp-bucket-cleaner
      annotations:
        description: "Periodic cleanup of orphaned Google cloud assetstore buckets"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "orphaned-assetstore-gcp-bucket-cleaner"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-project-env: "true"
      cron: "00 00 * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/ko/gcscleaner:v20230726-19a09015"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/ko-app/gcscleaner"
            args:
              - "-project=$(CLOUDSDK_CORE_PROJECT)"
              - "-bucketNameRegexp='^.+-([a-z0-9]+$)'"
              - "-excludedBuckets='kyma-prowjobs-secrets,kyma-prow-logs,kyma-prow-artifacts,kyma-development-artifacts,kyma-backup-restore,eu.artifacts.sap-kyma-prow.appspot.com,kyma-prow-access-storage-logs,kyma-prow-workloads-logs,eu.artifacts.sap-kyma-prow-workloads.appspot.com'"
              - "-workerNumber=10"
              - "-logLevel=info"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: orphaned-disks-cleaner
      annotations:
        description: "Periodic cleanup of orphaned Google cloud disks"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "orphaned-disks-cleaner"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-project-env: "true"
        preset-sa-gke-kyma-integration: "true"
      cron: "30 * * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/ko/diskscollector:v20230726-19a09015"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/ko-app/diskscollector"
            args:
              - "-project=$(CLOUDSDK_CORE_PROJECT)"
              - "-dryRun=false"
              - "-diskNameRegex='.*'"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: orphaned-ips-cleaner
      annotations:
        description: "Periodic cleanup of orphaned Google cloud IPs"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "orphaned-ips-cleaner"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-project-env: "true"
        preset-sa-gke-kyma-integration: "true"
      cron: "0 1 * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/ko/ipcleaner:v20230726-19a09015"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/ko-app/ipcleaner"
            args:
              - "-project=$(CLOUDSDK_CORE_PROJECT)"
              - "-dry-run=false"
              - "-ip-exclude-name-regex='^nightly|nightly-(.*)|weekly|weekly-(.*)|nat-auto-ip'"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: orphaned-clusters-cleaner
      annotations:
        description: "Periodic cleanup of orphaned Google cloud clusters"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "orphaned-clusters-cleaner"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-project-env: "true"
        preset-sa-gke-kyma-integration: "true"
      cron: "0 * * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/ko/clusterscollector:v20230726-19a09015"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/ko-app/clusterscollector"
            args:
              - "-project=$(CLOUDSDK_CORE_PROJECT)"
              - "-dryRun=false"
              - "-excluded-clusters=kyma-prow,workload-kyma-prow,nightly,weekly,nightly-20,nightly-21,nightly-22,persist"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: orphaned-vms-cleaner
      annotations:
        description: "Periodic cleanup of orphaned Google cloud VMs"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "orphaned-vms-cleaner"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-project-env: "true"
        preset-sa-gke-kyma-integration: "true"
      cron: "15,45 * * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/ko/vmscollector:v20230726-19a09015"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/ko-app/vmscollector"
            args:
              - "-project=$(CLOUDSDK_CORE_PROJECT)"
              - "-vmNameRegexp='gke-nightly-.*|gke-weekly.*|shoot--kyma-prow.*|gke-gke-release-.*'"
              - "-jobLabelRegexp='kyma-gke-nightly|kyma-gke-nightly-.*|kyma-gke-weekly|kyma-gke-weekly-.*|post-rel.*-kyma-release-candidate'"
              - "-dryRun=false"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: orphaned-loadbalancer-cleaner
      annotations:
        description: "Periodic cleanup of orphaned Google cloud load balancers"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "orphaned-loadbalancer-cleaner"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-project-env: "true"
        preset-sa-gke-kyma-integration: "true"
      cron: "15 * * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/ko/orphanremover:v20230726-19a09015"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/ko-app/orphanremover"
            args:
              - "-project=$(CLOUDSDK_CORE_PROJECT)"
              - "-dryRun=false"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: orphaned-dns-cleaner
      annotations:
        description: "Periodic cleanup of orphaned Google cloud DNS records"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "orphaned-dns-cleaner"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-compute-envs: "true"
        preset-gc-project-env: "true"
        preset-sa-gke-kyma-integration: "true"
      cron: "30 * * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/ko/dnscollector:v20230726-19a09015"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/ko-app/dnscollector"
            args:
              - "-project=$(CLOUDSDK_CORE_PROJECT)"
              - "-dnsZone=$(CLOUDSDK_DNS_ZONE_NAME)"
              - "-ageInHours=2"
              - "-regions=$(CLOUDSDK_COMPUTE_REGION)"
              - "-dryRun=false"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: gcr-cleaner-prow-workloads
      annotations:
        description: "Cleans up GCR images older than 7 days in eu.gcr.io/sap-kyma-prow-workloads"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "gcr-cleaner-prow-workloads"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-sa-gke-kyma-integration: "true"
      cron: "0 1 * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/ko/gcrcleaner:v20230726-19a09015"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/ko-app/gcrcleaner"
            args:
              - "--repository=eu.gcr.io/sap-kyma-prow-workloads"
              - "--age-in-hours=168"
              - "--dry-run=false"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: github-issues
      annotations:
        description: "Exports data from github to the big query (Grafana metrics)"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "github-issues"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-bot-github-sap-token: "true"
        preset-bot-github-token: "true"
        preset-sa-prow-job-github-issues: "true"
      cron: "0 6 * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      extra_refs:
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "europe-docker.pkg.dev/kyma-project/prod/test-infra/prow-tools:v20230710-20c3f243"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/github-issues.sh"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: serverless-function-metrics-generator
      annotations:
        description: "Serverless function metrics generator"
        owner: "otters"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "serverless-function-metrics-generator"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-gc-compute-envs: "true"
        preset-gc-project-env: "true"
        preset-sa-gke-kyma-integration: "true"
      cron: "0 0,12 * * *"
      skip_report: false
      decorate: true
      cluster: untrusted-workload
      extra_refs:
        - org: kyma-project
          repo: kyma
          base_ref: main
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/cluster-integration/kyma-serverless-metrics-nightly.sh"
            env:
              - name: CLOUDSDK_COMPUTE_ZONE
                value: "europe-west4-b"
              - name: CLUSTER_PROVIDER
                value: "gcp"
              - name: INPUT_CLUSTER_NAME
                value: "nightly"
              - name: PROVISION_REGIONAL_CLUSTER
                value: "true"
            resources:
              requests:
                memory: 3Gi
                cpu: 2
    - name: kyma-integration-k3d
      annotations:
        description: "Kyma integration periodic job on k3d"
        owner: "goat"
        testgrid-dashboards: "kyma_integration"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "kyma-integration-k3d"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-main: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-central-app-connectivity-enabled: "true"
        preset-sa-vm-kyma-integration: "true"
      cron: "5 * * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      extra_refs:
        - org: kyma-project
          repo: kyma
          base_ref: main
        - org: kyma-incubator
          repo: local-kyma
          base_ref: main
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            resources:
              requests:
                memory: 100Mi
                cpu: 50m
    - name: kyma-integration-k3d-telemetry
      annotations:
        description: "runs telemetry integration tests on k3d"
        owner: "huskies"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "kyma-integration-k3d-telemetry"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-main: "true"
        preset-gc-project-env: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-integration-telemetry-enabled: "true"
        preset-sa-vm-kyma-integration: "true"
      cron: "0 1,13 * * *"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      extra_refs:
        - org: kyma-project
          repo: kyma
          base_ref: main
        - org: kyma-project
          repo: test-infra
          base_ref: main
      reporter_config:
        slack:
          channel: huskies-notifications
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: false
              seccompProfile:
                type: RuntimeDefault
              allowPrivilegeEscalation: false
            command:
              - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/provision-vm-and-start-kyma-k3d.sh"
            resources:
              requests:
                memory: 3Gi
                cpu: 2
    - name: kyma-gke-nightly
      annotations:
        description: "Kyma GKE nightly build (depraceted, needed for sec scans)"
        owner: "neighbors"
        testgrid-create-test-group: "false"
      labels:
        prow.k8s.io/pubsub.project: "sap-kyma-prow"
        prow.k8s.io/pubsub.runID: "kyma-gke-nightly"
        prow.k8s.io/pubsub.topic: "prowjobs"
        preset-build-main: "true"
        preset-certificates-bucket: "true"
        preset-cluster-use-ssd: "true"
        preset-cluster-version: "true"
        preset-dind-enabled: "true"
        preset-docker-push-repository-gke-integration: "true"
        preset-gc-compute-envs: "true"
        preset-gc-project-env: "true"
        preset-kms-gc-project-env: "true"
        preset-kyma-artifacts-bucket: "true"
        preset-kyma-encryption-key: "true"
        preset-kyma-guard-bot-github-token: "true"
        preset-kyma-keyring: "true"
        preset-nightly-github-integration: "true"
        preset-sa-gke-kyma-integration: "true"
        preset-slack-alerts: "true"
      cron: "0 2 * * 1-5"
      skip_report: false
      decorate: true
      cluster: trusted-workload
      extra_refs:
        - org: kyma-project
          repo: kyma
          base_ref: main
        - org: kyma-project
          repo: test-infra
          base_ref: main
      spec:
        containers:
          - image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20230414-8e724501"
            securityContext:
              privileged: true
              seccompProfile:
                type: Unconfined
              allowPrivilegeEscalation: true
            command:
              - "bash"
            args:
              - "-c"
              - "${KYMA_PROJECT_DIR}/test-infra/prow/scripts/cluster-integration/kyma-gke-long-lasting.sh"
            env:
              - name: CLOUDSDK_COMPUTE_ZONE
                value: "europe-west4-b"
              - name: GITHUB_TEAMS_WITH_KYMA_ADMINS_RIGHTS
                value: "cluster-access"
              - name: INPUT_CLUSTER_NAME
                value: "nightly"
              - name: MACHINE_TYPE
                value: "custom-8-15360"
              - name: NODES_PER_ZONE
                value: "1"
              - name: PROVISION_REGIONAL_CLUSTER
                value: "true"
              - name: STACKDRIVER_COLLECTOR_SIDECAR_IMAGE_TAG
                value: "0.6.4"
              - name: TEST_RESULT_WINDOW_TIME
                value: "6h"
            resources:
              requests:
                memory: 200Mi
                cpu: 80m
  