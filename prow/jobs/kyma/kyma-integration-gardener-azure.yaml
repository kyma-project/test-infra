# Kubectl 1.16
base_image: &base_image
  image: eu.gcr.io/kyma-project/test-infra/kyma-cluster-infra:v20200206-22eb97a4

periodics:
- name: kyma-integration-gardener-azure
  decorate: true
  decoration_config:
    timeout: 14400000000000 # 4h
    grace_period: 600000000000 # 10min
  cron: "00 11 * * *"
  extra_refs:
    - org: kyma-project
      repo: test-infra
      path_alias: github.com/kyma-project/test-infra
      base_ref: master
  labels:
    preset-gardener-azure-kyma-integration: "true"
    preset-kyma-cli-stable: "true"
    preset-creds-aks-kyma-integration: "true"
  spec:
    containers:
    - <<: *base_image
      securityContext:
        privileged: true
      command:
      - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/cluster-integration/kyma-integration-gardener-azure.sh"
      env:
      - name: RS_GROUP
        value: "kyma-gardener-azure"
      - name: REGION
        value: "northeurope"
      - name: EVENTHUB_NAMESPACE_NAME
        value: "kyma-gardener-azure"
      - name: KYMA_PROJECT_DIR
        value: "/home/prow/go/src/github.com/kyma-project"
      - name: GARDENER_REGION
        value: "westeurope"
      resources:
        requests:
          memory: 1Gi
          cpu: 400m

- name: kyma-gardener-backup-nightly
  cron: "0 5 * * 1-5" # "At 05:00 on every day-of-week from Monday through Friday."
  decorate: true
  decoration_config:
    timeout: 14400000000000 # 4h
    grace_period: 600000000000 # 10min
  extra_refs:
    - org: kyma-project
      repo: test-infra
      base_ref: master
      path_alias: github.com/kyma-project/test-infra
    - org: kyma-project
      repo: kyma
      base_ref: master
      path_alias: github.com/kyma-project/kyma
  labels:
    preset-kyma-cli-stable: "true"
    preset-gardener-azure-kyma-integration: "true"
    preset-sa-gke-kyma-integration: "true"
    preset-creds-aks-kyma-integration: "true"
    preset-gc-compute-envs: "true"
    preset-gc-project-env: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - <<: *base_image
      securityContext:
        privileged: true
      command:
        - "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/cluster-integration/kyma-gardener-backup-test.sh"
      env:
        - name: CLOUDSDK_COMPUTE_ZONE
          value: "europe-west4-a"
        - name: REGION
          value: "westeurope"
      resources:
        requests:
          memory: 1Gi
          cpu: 400m
