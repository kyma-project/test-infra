test_infra_ref: &test_infra_ref
  org: kyma-project
  repo: test-infra
  path_alias: github.com/kyma-project/test-infra

kyma_ref: &kyma_ref
  org: kyma-project
  repo: kyma
  path_alias: github.com/kyma-project/kyma

periodics:
- name: kyma-vulnerabilites-scan
  cron: "0 4 1,14 * *" # At 04:00 am every 1st and 14th day
  labels:
    preset-sap-slack-bot-token: "true"
    preset-kyma-snyk-token: "true"
  decorate: true
  extra_refs:
    - <<: *test_infra_ref
      base_ref: master
    - <<: *kyma_ref
      base_ref: master
  spec:
    containers:
      - image: eu.gcr.io/kyma-project/test-infra/vulnerability-scanner:v20190226-14fa550
        command:
          - "bash"
        env:
          - name: KYMA_PROJECT_DIR
            value: "/home/prow/go/src/github.com/kyma-project"
        args:
          - "-c"
          - "${KYMA_PROJECT_DIR}/test-infra/development/vulnerabilities-scanner.sh"
        resources:
          requests:
            memory: 100Mi
            cpu: 50m
- name: kyma-gcp-container-vulnerability-collector
  decorate: true
  cron: "0 4 1,14 * *" # At 04:00 am every 1st and 14th day
  labels:
    preset-sap-slack-bot-token: "true"
    preset-kyma-slack-channel: "true"
    preset-sa-prow-gcp-vulnerability-chk: "true" # service account with Occurence Viewer permission
  extra_refs:
    - <<: *test_infra_ref
      base_ref: master
    - <<: *kyma_ref
      base_ref: master
  spec:
    containers:
      - image: eu.gcr.io/kyma-project/test-infra/buildpack-golang:v20190116-69aa0a1
        command:
          - "bash"
        args:
          - "-c"
          - "/home/prow/go/src/github.com/kyma-project/test-infra/development/container-vulnerabilities.sh -project=kyma-project -region=eu -dryRun=false"
        resources:
          requests:
            memory: 10Mi
            cpu: 100m