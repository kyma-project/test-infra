test_infra_ref: &test_infra_ref
  org: kyma-project
  repo: test-infra
  path_alias: github.com/kyma-project/test-infra

kyma_ref: &kyma_ref
  org: kyma-project
  repo: kyma
  path_alias: github.com/kyma-project/kyma

periodics:
- name: kyma-vulnerabilites-scan
  cron: "0 6 * * 1" # "At 06:00 on Monday."
  labels:
    preset-sap-slack-bot-token: "true"
    preset-kyma-snyk-token: "true"
  decorate: true
  extra_refs:
    - <<: *test_infra_ref
      base_ref: master
    - <<: *kyma_ref
      base_ref: master
  spec:
    containers:
      - image: eu.gcr.io/kyma-project/test-infra/vulnerability-scanner:v20190226-14fa550
        command:
          - "bash"
        env:
          - name: KYMA_PROJECT_DIR
            value: "/home/prow/go/src/github.com/kyma-project"
        args:
          - "-c"
          - "${KYMA_PROJECT_DIR}/test-infra/development/vulnerabilities-scanner.sh"
        resources:
          requests:
            memory: 100Mi
            cpu: 50m
- name: kyma-gcp-container-vulnerability-collector
  decorate: true
  cron: "0 0 1 * *" # “At 00:00 on day-of-month 1.”
  labels:
    preset-sap-slack-bot-token: "true"
    preset-kyma-slack-channel: "true"
  spec:
    containers:
      - image: eu.gcr.io/kyma-project/prow/test-infra/bootstrap:v20181121-f3ea5ce
        command:
          - "bash"
        env:
          - name: KYMA_PROJECT_DIR
            value: "/home/prow/go/src/github.com/kyma-project"
          - name: SCAN_WHITELIST
            value: "acs-installer,add-ons-ui,alpine-net,api-controller,apiserver-proxy,application-broker,application-connectivity-certs-setup-job,application-connectivity-validator,application-connector,application-gateway,application-operator,application-proxy,application-registry,ark-plugins,asset-metadata-service,asset-store-controller-manager,asset-upload-service,assetstore-controller-manager,azure-broker,binding-usage-controller,brokers-ui,c4c-mock,catalog,catalog-ui,changelog-generator,cms-controller-manager,commerce-mock,configurations-generator,connection-token-handler,connectivity-certs-controller,connector-service,console,console-backend-service,contacts,contacts-app,contacts-app-ui,contacts-ui-web,contacts-web-ui,content,content-to-json-generator,content-ui,dex,dex-static-user-configurer,documentation-generator,e2etest,environments,etcd-backup,etcd-tls-setup,event-bus,event-bus-e2e-subscriber,event-bus-nats-init,event-bus-publish,event-bus-publish-knative,event-bus-push,event-bus-sub-validator,event-bus-subscription-controller-knative,event-gateway,event-service,example,example-test-buildpack,examples,faros-bundles,faros-mock,gateway,gcp-broker-provider,gcp-installer,golang-buildpack,helm-broker,helm-broker-reposerver,helm-broker-tools,iam-kubeconfig-service,incubator,installer,instances,instances-ui,integration-dex,istio-kyma-patch,istio-webhook,k8s-dashboard-proxy,kube-rbac-proxy,kubebuilder-poc,kubeless-images-node6,kubeless-images-node8,kyma,kyma-installer,kyma-operator,lambda,log-ui,marketing-mock,marketplaces,metadata-service,namespace-controller,navigation-builder,node-buildpack,pod-tracker,prow,proxy-service,rc,release,release-adder,remote-environment-broker,remote-environment-controller,resources-uploader,sbu-upgrade-protector,service-catalog,stability-checker,static-users-generator,test-environments,test-infra,test-logging,test-logging-monitoring,test-namespace-controller,ui-api-layer,varkes-app-connector,varkes-app-connector-client,varkes-commerce-mock,varkes-marketing-mock,varkes-odata-mock,varkes-openapi-mock,velero-plugins,watch-pods,xf-application-mocks,xip-patch"
        args:
          - "-c"
          - "${KYMA_PROJECT_DIR}/test-infra/development/container-vulnerabilities.sh -project=kyma-project -region=eu -whitelist=${SCAN_WHITELIST}"
        resources:
          requests:
            memory: 10Mi
            cpu: 100m