presets:
- labels:
    preset-high-load: "true"
  tolerations:
  - key: resources-usage
    value: high
    operator: Equal
    effect: NoSchedule

job_labels_template: &job_labels_template
  preset-dind-enabled: "true"
  preset-sa-gcr-push: "true"
  preset-docker-push-repository-test-infra: "true"
  preset-high-load: "true"

presubmits: # runs on PRs
  kyma-project/test-infra:
  - name: pre-master-kind-kubernetes-image
    branches:
    - ^master$
    skip_report: false
    decorate: true
    path_alias: github.com/kyma-project/test-infra
    max_concurrency: 10
    run_if_changed: "^kind/KIND_KUBERNETES_VERSION"
    labels:
      <<: *job_labels_template
      preset-build-pr: "true"
    spec:
      containers:
      - image:  eu.gcr.io/kyma-project/test-infra/buildpack-golang-toolbox:v20191002-afa0089
        securityContext:
          privileged: true
        command:
        - make
        args:
        - -C
        - /home/prow/go/src/github.com/kyma-project/test-infra/kind
        - ci-pr
        resources:
          requests:
            memory: 8Gi
            cpu: 4
          limits:
            memory: 10Gi
            cpu: 5

postsubmits:
  kyma-project/test-infra:
  - name: post-master-kind-kubernetes-image
    branches:
    - ^master$
    skip_report: false
    decorate: true
    path_alias: github.com/kyma-project/test-infra
    max_concurrency: 10
    run_if_changed: "^kind/KIND_KUBERNETES_VERSION"
    labels:
      <<: *job_labels_template
      preset-build-master: "true"
    spec:
      containers:
      - image:  eu.gcr.io/kyma-project/test-infra/buildpack-golang-toolbox:v20191002-afa0089
        securityContext:
          privileged: true
        command:
        - make
        args:
        - -C
        - /home/prow/go/src/github.com/kyma-project/test-infra/kind
        - ci-master
        resources:
          requests:
            memory: 10Gi
            cpu: 4
          limits:
            memory: 10Gi
            cpu: 5
