name: pull-lint-prod-terraform
on: # runs on main
  pull_request:
    types: [opened, edited, synchronize, reopened, ready_for_review]
    branches:
    - main
    paths:
    - '**.tf'
    - '**.tfvars'
    - '**.yaml'
    - '**.yml'
jobs:
  pull-lint-prod-terraform:
    
    runs-on: ubuntu-latest
    
    steps:
        - uses: actions/checkout@v3
          name: Checkout source code
        
        - uses: actions/cache@v3
          name: Cache plugin dir
          with:
            path: ~/.tflint.d/plugins
            key: ${{ matrix.os }}-tflint-${{ hashFiles('.tflint.hcl') }}
        
        - uses: terraform-linters/setup-tflint@v3
          name: Setup TFLint
        
        - name: Show version
          run: tflint --version
        
        - name: Init TFLint
          run: tflint --init
          env:
            # https://github.com/terraform-linters/tflint/blob/master/docs/user-guide/plugins.md#avoiding-rate-limiting
            GITHUB_TOKEN: ${{ github.token }}
        
        - name: Run TFLint
          run: tflint -chdir=./configs/terraform/environments/prod --recursive -f compact
