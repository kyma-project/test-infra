name: Caller Workflow

on:
  workflow_run:
    workflows: ["Get OIDC Token Workflow"]
    types:
      - completed

jobs:
  call_reusable_with_oidc:
    permissions:
        contents: read
        actions: read
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Download OIDC Token Artifact
        uses: actions/download-artifact@v2
        with:
          name: oidc-token-artifact
          path: ./

      - name: Read OIDC Token From File
        id: read_oidc_token
        run: echo "::set-output name=token::$(<oidc_token.txt)"
      
      - name: Call Reusable Workflow with OIDC Token
        uses: ./.github/workflows/reusable_workflow.yml@main
        with:
          oidc_token: ${{ steps.read_oidc_token.outputs.token }}
