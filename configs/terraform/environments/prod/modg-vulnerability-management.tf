resource "google_service_account" "kyma-modules-reader-modg" {
	account_id   = var.modg-vulnerability-management-artifactregistry-reader.registry_reader_sa
	display_name = var.modg-vulnerability-management-artifactregistry-reader.registry_reader_sa
	description  = var.modg-vulnerability-management-artifactregistry-reader.sa_description
}

resource "google_artifact_registry_repository_iam_member" "kyma_modules_reader_modg" {
	project    = module.kyma_modules.artifact_registry.project
	repository = module.kyma_modules.artifact_registry.name
	location   = module.kyma_modules.artifact_registry.location
	role       = "roles/artifactregistry.reader"
	member     = "serviceAccount:${google_service_account.kyma-modules-reader-modg.email}"
}

variable "modg-vulnerability-management-artifactregistry-reader" {
	type = object({
		registry_reader_sa       = string
		sa_description           = string
	})
	default = {
		registry_reader_sa   = "modg-vuln-mgmt-reg-reader"
		sa_description     = "Temporary service account for MODG Vulnerability Management with read-only access to the kyma-modules Artifact Registry. Owned by Torsten Dangel."
	}
}
