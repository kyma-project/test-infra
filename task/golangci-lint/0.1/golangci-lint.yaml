apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: golangci-lint
  labels:
    app.kubernetes.io/version: "0.1"
  annotations:
    tekton.dev/pipelines.minVersion: "0.36.0"
    tekton.dev/categories: Code Quality
    tekton.dev/tags: linter
    tekton.dev/displayName: "golangci-lint"
    tekton.dev/platforms: "linux/amd64"
spec:
  description: >-
    The golangci-lint Task runs a golang linter.
    Task is tailored to be triggered by prow as a prowjob.
    It uses a golangci-lint tool.
    The golangci tool config is stored in the .golangci.yaml file which is read from a repository hosting tested code.
    A workspace named repo stores the source code to lint.
  workspaces:
    - name: repo
      description: "The workspace where sources to lint are stored. Usually it should be a shared workspace with other tasks. A default mount path is aligned with prowjob running under a kubernetes agent."
      mountPath: /home/prow/go
  params:
    - name: REPO_OWNER
      description: "GitHub org that triggered the job. Variable set by prow. Prow will not set this variable if the prowjob type is periodic. In that case an empty string default value will be used."
      type: string
      default: ""
    - name: REPO_NAME
      description: "GitHub repo that triggered the job. Variable set by prow. Prow will not set this variable if the prowjob type is periodic. In that case an empty string default value will be used."
      type: string
      default: ""
  steps:
    - name: lint-go-code
      image: eu.gcr.io/kyma-project/test-infra/golangci-lint:v20230221-85b2d35f
      workingDir: /home/prow/go/src/github.com/$(params.REPO_OWNER)/$(params.REPO_NAME)
      timeout: 30m
      resources:
        requests:
          memory: 1.5Gi
          cpu: 2
      command:
        - /golangci-lint.sh
