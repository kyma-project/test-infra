apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: go-unit-tests
  labels:
    app.kubernetes.io/version: "0.1"
  annotations:
    tekton.dev/pipelines.minVersion: "0.36.0"
    tekton.dev/categories: Code Quality
    tekton.dev/tags: test
    tekton.dev/displayName: "go-unit-tests"
    tekton.dev/platforms: "linux/amd64"
spec:
  description: >-
    TODO
  workspaces:
    - name: repo
      description: "The workspace where sources to test are stored."
      mountPath: /home/prow/go
  params:
    - name: path-to-test
      description: "The path to go code to test."
      type: string
      default: "./..."
    - name: REPO_OWNER
      description: "GitHub org that triggered the job. Variable set by prow. Prow will not set this variable if the prowjob type is periodic. In that case an empty string default value will be used."
      type: string
      default: ""
    - name: REPO_NAME
      description: "GitHub repo that triggered the job. Variable set by prow. Prow will not set this variable if the prowjob type is periodic. In that case an empty string default value will be used."
      type: string
      default: ""
  results:
    - name: commit
      description: The precise commit SHA that was fetched by this Task.
    - name: url
      description: The precise URL that was fetched by this Task.
    - name: committer-date
      description: The epoch timestamp of the commit that was fetched by this Task.
  steps:
    - name: go-unit-tests
      image: eu.gcr.io/kyma-project/test-infra/golangci-lint:v20230221-85b2d35f
      workingDir: /home/prow/go/src/github.com/$(params.REPO_OWNER)/$(params.REPO_NAME)
      command:
        - "go"
      args:
        - "test"
        - "-cover"
        - "$(params.path-to-test)"
      resources:
        requests:
          memory: 500M
          cpu: 500m
