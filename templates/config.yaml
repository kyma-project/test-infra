global:
  nextRelease: "1.24"
  releases:
    - "1.23"
    - "1.22"
    - "1.21"

# global configSet variables
pubsub_config: &pubsub_config
  pubsub_project: "sap-kyma-prow"
  pubsub_topic: "prowjobs"
  
globalSets:
  # Image sets
  image_bootstrap:
    image: "eu.gcr.io/kyma-project/test-infra/bootstrap:PR-2951"
  image_prow-tools:
    image: "eu.gcr.io/kyma-project/test-infra/prow-tools:current"
  image_kyma-integration:
    image: "eu.gcr.io/kyma-project/test-infra/kyma-integration:v20210519-51c0242d-k8s1.16"
  image_buildpack-node:
    image: "eu.gcr.io/kyma-project/test-infra/buildpack-node:PR-2951"
  image_buildpack-golang:
    image: "eu.gcr.io/kyma-project/test-infra/buildpack-golang:go1.16.4"
  image_buildpack-golang-kubebuilder2:
    image: "eu.gcr.io/kyma-project/test-infra/buildpack-golang-kubebuilder2:v20210601-24c60b5a"
  image_buildpack-golang-toolbox:
    image: "eu.gcr.io/kyma-project/test-infra/buildpack-golang-toolbox:v20210601-19326f24"
  image_wssagent:
    image: "eu.gcr.io/kyma-project/test-infra/wssagent:v20210421-b3790671"
  # JobConfig sets
  jobConfig_default:
    skip_report: "false"
    max_concurrency: "10"
    decorate: "true"
    branches:
      - "^master$"
      - "^main$"
    privileged: "true"
    request_memory: "1.5Gi"
    request_cpu: "0.8"
    cluster_presubmit: "untrusted-workload"
    cluster_postsubmit: "trusted-workload"
    <<: *pubsub_config
  jobConfig_presubmit:
    type_presubmit: "true"
    cluster: "untrusted-workload"
  jobConfig_postsubmit:
    type_postsubmit: "true"
    cluster: "trusted-workload"
  jobConfig_periodic:
    type_periodic: "true"
    cluster: "untrusted-workload"
  disable_testgrid:
    annotations:
      testgrid-create-test-group: "false"
  jobConfig_generic_component:
    labels:
      preset-dind-enabled: "true"
      preset-sa-gcr-push: "true"
      preset-docker-push-repository-kyma: "true"
    command: "/home/prow/go/src/github.com/kyma-project/test-infra/prow/scripts/build-generic.sh"
  # globalSet for prowjobs which don't inherit jobConfig_default globalSet
  pubsub_labels:
    <<: *pubsub_config
  # extra_refs sets
  extra_refs_test-infra:
    extra_refs:
      test-infra:
        - org: "kyma-project"
          repo: "test-infra"
          path_alias: "github.com/kyma-project/test-infra"
          base_ref: "main"
  extra_refs_kyma:
    extra_refs:
      kyma:
        - org: "kyma-project"
          repo: "kyma"
          path_alias: "github.com/kyma-project/kyma"
          base_ref: "main"
  # labels sets
  build_labels:
    labels:
      preset-dind-enabled: "true"
      preset-sa-gcr-push: "true"
      preset-docker-push-repository-kyma: "true"




# kyma_generic_component: &kyma_generic_component
#   repository: github.com/kyma-project/kyma
#   pushRepository: kyma
#   buildpackTag: v20210601-24c60b5a
#   additionalRunIfChanged:
#     - ^common/makefiles/

# compass_generic_component: &compass_generic_component
#   repository: github.com/kyma-incubator/compass
#   build: build
#   pushRepository: incubator
#   bootstrapTag: PR-2951
#   additionalRunIfChanged:
#     - ^scripts/

# compass_ord_service_generic_component: &compass_ord_service_generic_component
#   repository: github.com/kyma-incubator/ord-service
#   build: build
#   pushRepository: incubator
#   bootstrapTag: PR-2951
#   additionalRunIfChanged:
#     - ^scripts/

# compass_console_generic_component: &compass_console_generic_component
#   repository: github.com/kyma-incubator/compass-console
#   pushRepository: incubator
#   build: build
#   bootstrapTag: PR-2951
#   additionalRunIfChanged:
#     - ^components/
#     - ^shared/
#     - ^package.json

# control_plane_generic_component: &control_plane_generic_component
#   repository: github.com/kyma-project/control-plane
#   build: build
#   pushRepository: control-plane
#   buildpackTag: v20210601-24c60b5a
#   additionalRunIfChanged:
#     - ^scripts/

# console_generic_component: &console_generic_component
#   repository: github.com/kyma-project/console
#   pushRepository: kyma
#   build: build-console
#   bootstrapTag: PR-2951
#   additionalRunIfChanged:
#     - ^components/
#     - ^shared/
#     - ^package.json

# busola_generic_component: &busola_generic_component
#   repository: github.com/kyma-project/busola
#   pushRepository: kyma
#   build: build-busola
#   bootstrapTag: PR-2951
#   additionalRunIfChanged:
#     - ^components/
#     - ^shared/
#     - ^package.json

# Default definition of workload clusters
cluster_default: &cluster_default
  cluster:
    presubmit: untrusted-workload
    postsubmit: trusted-workload
    periodic: trusted-workload

templates:
#  - from: templates/kyma-release-upgrade.yaml
#    render:
#      - to: ../prow/jobs/kyma/kyma-release-upgrade.yaml
  - from: templates/releases.go.tmpl
    render:
      - to: ../development/tools/jobs/releases/releases.go
#  TODO: remove when https://github.com/kyma-project/test-infra/issues/3174 is finished
#  - from: templates/kyma-github-release.yaml
#    render:
#      - to: ../prow/jobs/kyma/kyma-github-release.yaml
#        values:
#          <<: *cluster_default
#  - from: templates/kyma-release-candidate.yaml
#    render:
#      - to: ../prow/jobs/kyma/kyma-release-candidate.yaml
#        values:
#          <<: *cluster_default
  - from: templates/prow-config.yaml
    render:
      - to: ../prow/config.yaml
        values:
          <<: *cluster_default
          contexts:
            - name: kyma-integration
            - name: kyma-gke-integration
            - name: kyma-gke-upgrade
            - name: kyma-artifacts
  - from: templates/testgrid-default.yaml
    render:
      - to: ../prow/testgrid-default.yaml
