templates:
  - from: templates/generic.tmpl
    render:
      - to: ../prow/jobs/halamix2_test.yaml
        localSets:
          jobConfig_generic_component:
            since: "1.7"
            labels:
              preset-docker-push-repository-kyma: "true"
            run_if_changed: '^components/application-broker/|^common/makefiles/'
            args:
              - "/home/prow/go/src/kyma/application-broker"
        jobConfigs:
          - repoName: "github.com/kyma-project/kyma"
            jobs:
              - jobConfig:
                  name: "pre-kyma-components-application-broker"
                  branches:
                    - ^master$
                    - ^main$
                inheritedConfigs:
                  global:
                    - "jobConfig_default"
                    - "jobConfig_presubmit"
                    - "image_buildpack-golang-kubebuilder2"
                    - "jobConfig_generic_component"
                    - "extra_refs_test-infra"
                  local:
                    - "jobConfig_generic_component"
              - jobConfig:
                  name: "post-kyma-components-application-broker"
                  branches:
                    - ^master$
                    - ^main$
                  slack_channel: "kyma-prow-dev-null"
                inheritedConfigs:
                  global:
                    - "jobConfig_default"
                    - "jobConfig_postsubmit"
                    - "image_buildpack-golang-kubebuilder2"
                    - "jobConfig_generic_component"
                    - "extra_refs_test-infra"
                  local:
                    - "jobConfig_generic_component"
            {{- range $rel := .Global.releases }}
              - jobConfig:
                  name: "pre-rel{{ $rel | replace "." "" }}-kyma-components-application-broker"
                  branches:
                    - release-{{ $rel }}
                  extra_refs:
                    test-infra:
                      - org: "kyma-project"
                        repo: "test-infra"
                        path_alias: "github.com/kyma-project/test-infra"
                        base_ref: "release-{{- $rel }}"
                  release_current: "{{ $rel }}"
                  release_until: "1.22"
                inheritedConfigs:
                  global:
                    - "jobConfig_default"
                    - "jobConfig_presubmit"
                    - "image_buildpack-golang-kubebuilder2"
                    - "jobConfig_generic_component"
                    - "disable_testgrid"
                  local:
                    - "jobConfig_generic_component"
              - jobConfig:
                  name: "post-rel{{ $rel | replace "." "" }}-kyma-components-application-broker"
                  branches:
                    - release-{{ $rel }}
                  extra_refs:
                    test-infra:
                      - org: "kyma-project"
                        repo: "test-infra"
                        path_alias: "github.com/kyma-project/test-infra"
                        base_ref: "release-{{- $rel }}"
                  slack_channel: "kyma-prow-dev-null"
                  release_current: "{{ $rel }}"
                  release_until: "1.22"
                inheritedConfigs:
                  global:
                    - "jobConfig_default"
                    - "jobConfig_postsubmit"
                    - "image_buildpack-golang-kubebuilder2"
                    - "jobConfig_generic_component"
                    - "disable_testgrid"
                  local:
                    - "jobConfig_generic_component"
            {{ end }}
